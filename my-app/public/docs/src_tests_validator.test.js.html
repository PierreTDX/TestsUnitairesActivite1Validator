<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: src/tests/validator.test.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: src/tests/validator.test.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file validator.test.js
 * @description Unit tests for the validator utility module.
 */
import { calculateAge, validatePostalCode, validateIdentity, validateEmail, validateCity, saveToLocalStorage, getFromLocalStorage } from "../../src/utils/validator.js";

/**
* @function calculateAge
*/
describe('calculateAge Unit Test Suites', () => {
    let people20years;
    let people18years;
    let minor;
    let almost18;
    let future;

    beforeEach(() => {
        const today = new Date();
        // Dynamic date calculation ensures tests pass next year
        people20years = {
            birth: new Date(today.getFullYear() - 20, today.getMonth(), today.getDate())
        };
        people18years = {
            birth: new Date(today.getFullYear() - 18, today.getMonth(), today.getDate())
        };
        minor = {
            birth: new Date(today.getFullYear() - 17, today.getMonth(), today.getDate())
        };
        almost18 = {
            birth: new Date(today.getFullYear() - 18, today.getMonth(), today.getDate() + 1)
        };
        future = {
            birth: new Date(today.getFullYear() + 1, today.getMonth(), today.getDate())
        };
    })

    it('should return a correct age', () => {
        expect(calculateAge(people20years)).toEqual(20)
    })

    it('should throw an error when no argument is passed', () => {
        expect(() => calculateAge()).toThrow("missing param p")
    })

    it('should throw an error when the argument is not an object', () => {
        expect(() => calculateAge("not-an-object")).toThrow("param p must be an object")
    })

    it('should throw an error when the object does not contain a birth field', () => {
        expect(() => calculateAge({})).toThrow("missing param p.birth")
    })

    it('should throw an error when the birth field is not a Date object', () => {
        expect(() => calculateAge({ birth: "1990-01-01" })).toThrow("p.birth must be a Date object")
    })

    it('should throw an error when the birth date is invalid', () => {
        expect(() => calculateAge({ birth: new Date("invalid-date") })).toThrow("p.birth is an invalid Date")
    })

    it('should throw an error for a minor (&lt; 18 years old)', () => {
        expect(() => calculateAge(minor)).toThrow("Age must be at least 18 years old.")
    })

    it('should return 18 for someone exactly 18 years old', () => {
        expect(calculateAge(people18years)).toEqual(18)
    })

    it('should throw an error for someone who turns 18 tomorrow', () => {
        expect(() => calculateAge(almost18)).toThrow("Age must be at least 18 years old.")
    })

    it('should throw an error for a future birth date', () => {
        expect(() => calculateAge(future)).toThrow("Age must be at least 18 years old.")
    })

    it('should throw an error when p is null', () => {
        expect(() => calculateAge(null)).toThrow("missing param p")
    })

    it('should throw an error for a birth year before 1900', () => {
        expect(() => calculateAge({ birth: new Date('0008-01-01') })).toThrow("Birth year must be 1900 or later.")
    })

    it('should correctly calculate age for a person born on Feb 29th (Leap Year)', () => {
        const today = new Date();
        // February 29, 2000 (Leap Year, Adult)
        const leapBirth = new Date(2000, 1, 29);

        // Manual calculation of expected age to verify the function
        let expectedAge = today.getFullYear() - 2000;
        const m = today.getMonth() - 1; // Février est le mois 1
        if (m &lt; 0 || (m === 0 &amp;&amp; today.getDate() &lt; 29)) {
            expectedAge--;
        }

        expect(calculateAge({ birth: leapBirth })).toEqual(expectedAge);
    })
})

/**
 * @function validatePostalCode
 */
describe('validatePostalCode Unit Test Suites', () => {
    it('should return true for a valid french postal code (5 digits)', () => {
        expect(validatePostalCode("33000")).toBe(true)
    })

    it('should throw an error when no argument is passed', () => {
        expect(() => validatePostalCode()).toThrow("missing param code")
    })

    it('should throw an error when the argument is not a string', () => {
        expect(() => validatePostalCode(33000)).toThrow("code must be a string")
    })

    it('should throw an error when the code is too short', () => {
        expect(() => validatePostalCode("3300")).toThrow("code must be 5 digits")
    })

    it('should throw an error when the code is too long', () => {
        expect(() => validatePostalCode("330000")).toThrow("code must be 5 digits")
    })

    it('should throw an error when the code contains invalid characters', () => {
        expect(() => validatePostalCode("33A00")).toThrow("code must be 5 digits")
    })
})

/**
 * @function validateIdentity
 */
describe('validateIdentity Unit Test Suites', () => {
    it('should return true for a valid name (letters only)', () => {
        expect(validateIdentity("Pierre")).toBe(true)
    })

    it('should return true for a valid name with accents', () => {
        expect(validateIdentity("Hélène")).toBe(true)
    })

    it('should return true for a valid name with hyphens', () => {
        expect(validateIdentity("Jean-Pierre")).toBe(true)
    })

    it('should throw an error when no argument is passed', () => {
        expect(() => validateIdentity()).toThrow("missing param name")
    })

    it('should throw an error when the argument is not a string', () => {
        expect(() => validateIdentity(123)).toThrow("name must be a string")
    })

    it('should throw an error when the name contains numbers', () => {
        expect(() => validateIdentity("Pierre123")).toThrow("name must only contain letters, accents and hyphens")
    })

    it('should throw an error for potential XSS injection', () => {
        expect(() => validateIdentity("&lt;script>")).toThrow("name must only contain letters, accents and hyphens")
    })

    it('should throw an error when the name contains HTML tags', () => {
        expect(() => validateIdentity("&lt;b>Pierre&lt;/b>")).toThrow("name must only contain letters, accents and hyphens")
    })
})

/**
 * @function validateEmail
 */
describe('validateEmail Unit Test Suites', () => {
    it('should return true for a valid email', () => {
        expect(validateEmail("test@example.com")).toBe(true)
    })

    it('should throw an error when no argument is passed', () => {
        expect(() => validateEmail()).toThrow("missing param email")
    })

    it('should throw an error when the argument is not a string', () => {
        expect(() => validateEmail(123)).toThrow("email must be a string")
    })

    it('should throw an error when the email is invalid', () => {
        expect(() => validateEmail("invalid-email")).toThrow("email is invalid")
    })
})

/**
 * @function validateCity
 */
describe('validateCity Unit Test Suites', () => {
    it('should return true for a valid city', () => {
        expect(validateCity("Paris")).toBe(true)
    })

    it('should return true for a city with accents, spaces, hyphens and apostrophes', () => {
        expect(validateCity("L'Haÿ-les-Roses")).toBe(true)
    })

    it('should throw an error when no argument is passed', () => {
        expect(() => validateCity()).toThrow("missing param city")
    })

    it('should throw an error when the argument is not a string', () => {
        expect(() => validateCity(123)).toThrow("city must be a string")
    })

    it('should throw an error when the city contains numbers', () => {
        expect(() => validateCity("Paris75")).toThrow("city must only contain letters, accents, spaces, hyphens and apostrophes")
    })
})

/**
 * @function LocalStorage
 */
describe('LocalStorage Unit Test Suites', () => {
    beforeEach(() => {
        localStorage.clear()
        jest.restoreAllMocks()
    })

    describe('saveToLocalStorage', () => {
        it('should save data correctly', () => {
            const data = { firstName: 'Test' }
            expect(saveToLocalStorage(data)).toBe(true)

            const stored = JSON.parse(localStorage.getItem('registrations'))
            expect(stored).toHaveLength(1)
            expect(stored[0].firstName).toBe('Test')
            expect(stored[0].timestamp).toBeDefined()
        })

        it('should throw a ValidationError when localStorage fails', () => {
            jest.spyOn(Storage.prototype, 'setItem').mockImplementation(() => {
                throw new Error('QuotaExceededError')
            })
            expect(() => saveToLocalStorage({ firstName: 'Test' })).toThrow("Failed to save data to localStorage")
        })
    })

    describe('getFromLocalStorage', () => {
        it('should return an empty array if nothing is stored', () => {
            expect(getFromLocalStorage()).toEqual([])
        })

        it('should return stored data', () => {
            const data = [{ firstName: 'Test' }]
            localStorage.setItem('registrations', JSON.stringify(data))
            expect(getFromLocalStorage()).toEqual(data)
        })

        it('should throw a ValidationError when localStorage fails', () => {
            jest.spyOn(Storage.prototype, 'getItem').mockImplementation(() => {
                throw new Error('AccessDenied')
            })
            expect(() => getFromLocalStorage()).toThrow("Failed to retrieve data from localStorage")
        })
    })
})</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Components.html">Components</a></li><li><a href="module-validator.html">validator</a></li></ul><h3>Classes</h3><ul><li><a href="module-validator.ValidationError.html">ValidationError</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Home">Home</a></li><li><a href="global.html#LocalStorage">LocalStorage</a></li><li><a href="global.html#RegistrationForm">RegistrationForm</a></li><li><a href="global.html#calculateAge">calculateAge</a></li><li><a href="global.html#reportWebVitals">reportWebVitals</a></li><li><a href="global.html#runScenario">runScenario</a></li><li><a href="global.html#validateCity">validateCity</a></li><li><a href="global.html#validateEmail">validateEmail</a></li><li><a href="global.html#validateIdentity">validateIdentity</a></li><li><a href="global.html#validatePostalCode">validatePostalCode</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Thu Feb 19 2026 14:21:45 GMT+0100 (heure normale d’Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
